# AUTOSAVE 


1 -  clic new story = edit new ( mode nouvelle histoire )  = crÃ©er draft avec nouvel id. + autosave 2 secondes aprÃ¨s fin de frappe. bouton annuler = delete ce draft par id.

2 -  clic un histoire draft = edit draft ( mode continuer histoire ) = si je ne tape rien , pas d'autosave? Si je tape du texte = autosave 2 secondes apres fin de frappe. bouton supprimer = supprimer ce draft par id. 

3 - clic une histoire published  = edtit published ( mode modifier histoire ) = si je ne tape rien pas de sauvegarde en draft. 
Si je tape du texte  : new draft + nouvel id + original id + autosave 2 secondes aprÃ¨s fin de frappe. Supprimer = supprimer ce draft par id. ( sÃ©curitÃ© histoire originale ) . 


â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦

# SÃ©curitÃ© maximale ğŸ›¡ï¸

Les histoires publiÃ©es ne sont jamais modifiÃ©es directement
Toujours passer par un draft intermÃ©diaire â†’ ZÃ©ro risque de corruption

# Performance optimisÃ©e âš¡

Pas d'autosave inutile si l'utilisateur ne fait que consulter
Autosave uniquement aprÃ¨s action utilisateur rÃ©elle

# UX cohÃ©rente ğŸ¨

MÃªme dÃ©lai (2 secondes) pour tous les modes
MÃªme comportement : autosave aprÃ¨s fin de frappe

# Logique mÃ©tier claire ğŸ§ 
ModeTrigger DraftAutosaveBouton SupprimerNew Story1er caractÃ¨re2s aprÃ¨s frappeDelete draftEdit DraftDÃ©jÃ  existe2s aprÃ¨s frappeDelete draftEdit Published1er caractÃ¨re2s aprÃ¨s frappeDelete draft (original safe)
Ajustement nÃ©cessaire ğŸ”§
Votre logique implique une nuance importante :
Pour editNew et editPublished :

CrÃ©ation draft = ImmÃ©diate au 1er caractÃ¨re
Autosave = 2 secondes aprÃ¨s fin de frappe pour les modifications suivantes

Pour editDraft :

Autosave = 2 secondes aprÃ¨s fin de frappe


flow user =


1er cas :

 je clique nouvelle histoire = edit new editor vide. pas de bouton annuler visible. 

Je quitte la page? il ne s'est rien passer , pas de draft inutile. 

2eme cas : 

 je clique nouvelle histoire = edit new editor vide. pas de bouton annuler visible. 

je rÃ©dige un texte , pas de titre = "histoire sans titre". 

1er caractÃ¨re â†’ createDraft() â†’ storyId.set(newId)

bouton annuler apparait 

j'annule ? delete by id. 

3eme cas : 

 je clique nouvelle histoire = edit new editor vide. pas de bouton annuler visible. 

1er caractÃ¨re â†’ createDraft() â†’ storyId.set(newId)

bouton annuler apparait 

je met un titre ou pas puis je rÃ©dige un texte 

arrÃªt frappe = autosave 

je quitte la page = draft sauvÃ©. 


RÃ©capitulatif prÃ©cis du travail attendu ğŸ“‹
ProblÃ¨me Ã  corriger âŒ
L'autosave actuel se dÃ©clenche dÃ¨s l'ouverture d'un brouillon, avant mÃªme que l'utilisateur tape quoi que ce soit.
Comportement souhaitÃ© âœ…
Autosave uniquement 2 secondes aprÃ¨s avoir arrÃªtÃ© de taper au clavier.
Flow utilisateur validÃ© ğŸ¯
Mode editNew (nouvelle histoire) :

Ouvre Ã©diteur vide â†’ storyId = null â†’ Pas de bouton annuler
Premier caractÃ¨re â†’ createDraft() â†’ storyId.set(newId) â†’ Bouton annuler apparaÃ®t
ArrÃªt frappe â†’ Autosave 2s aprÃ¨s
Reste en mode editNew (pas de switch)

Mode editDraft (continuer brouillon) :

storyId existe dÃ©jÃ 
Si pas de modifications â†’ Pas d'autosave
Si modifications â†’ Autosave 2s aprÃ¨s arrÃªt frappe

Mode editPublished (modifier publiÃ©e) :

originalStoryId existe, storyId = null
Premier caractÃ¨re â†’ Nouveau draft â†’ storyId.set(newId)
Modifications â†’ Autosave 2s aprÃ¨s arrÃªt frappe

Architecture simplifiÃ©e ğŸ—ï¸
Service AutoSave :

DÃ©tecter changement utilisateur âœ…
Attendre 2 secondes aprÃ¨s arrÃªt âœ…
Appeler callback fourni par Editor âœ…
PAS de logique mÃ©tier (modes, crÃ©ation draft)

Editor garde le contrÃ´le :

Logique des modes
CrÃ©ation/suppression drafts
Boutons annuler/supprimer

Interface service ğŸ“
typescriptinterface AutoSave {
  data: Signal<{title: string, content: string}>;
  onSave: () => Promise<void>;
  delay?: number;
}
C'est tout. Simple et DRY. âœ…


Fichiers Ã  mettre Ã  jour ğŸ“
1. Service AutoSave ğŸ”§
src/app/services/auto-save.service.ts

Simplifier l'interface AutoSave
Supprimer la logique mÃ©tier (modes, crÃ©ation draft)
Garder seulement : dÃ©tection changement + debounce 2s + callback

2. Editor Component âš™ï¸
src/app/components/chroniques/stories/editor/editor.ts

Adapter l'utilisation du service AutoSave simplifiÃ©
Garder la logique mÃ©tier existante (modes, crÃ©ation draft)
Fournir le callback onSave au service

C'est tout ! âœ…
2 fichiers seulement car :

Les routes â†’ OK âœ…
Les templates â†’ OK âœ…
Les autres services â†’ OK âœ…
L'architecture â†’ OK âœ…

Modification ciblÃ©e et minimale pour corriger juste le problÃ¨me d'autosave intempestif.