{
  "task": "Créer le controller loadController.js pour L'Antre",
  "requirements": {
    "framework": "Express + Prisma",
    "code_quality": "Senior level - simple, robuste, efficace",
    "naming": "Noms logiques uniquement, pas d'inventions",
    "separators": "//======= SECTION =======",
    "no_logs": true,
    "no_comments": "Pas de commentaires parasites",
    "no_icons": "Pas d'icônes dans le code"
  },
  "controller_specs": {
    "filename": "loadController.js",
    "purpose": "Controller centralisé pour TOUT le chargement de données",
    "base_route": "/api/get"
  },
  "dependencies": [
    "PrismaClient",
    "authenticateToken middleware pour routes privées"
  ],
  "routes": {
    "getLatest": {
      "method": "GET",
      "path": "/latest",
      "auth": false,
      "purpose": "Dernières histoires publiques pour chroniques"
    },
    "getStory": {
      "method": "GET", 
      "path": "/story/:id",
      "auth": false,
      "purpose": "Story complète pour reader"
    },
    "getStories": {
      "method": "GET",
      "path": "/stories/:userId", 
      "auth": false,
      "purpose": "Liste histoires d'un utilisateur pour navigation"
    },
    "getStats": {
      "method": "GET",
      "path": "/stats",
      "auth": true,
      "purpose": "Statistiques utilisateur connecté"
    },
    "getDrafts": {
      "method": "GET",
      "path": "/drafts",
      "auth": true,
      "purpose": "Liste brouillons utilisateur connecté"
    },
    "getPublished": {
      "method": "GET", 
      "path": "/published",
      "auth": true,
      "purpose": "Liste histoires publiées utilisateur connecté"
    },
    "getDraftStory": {
      "method": "GET",
      "path": "/draft-story/:id",
      "auth": true,
      "purpose": "Brouillon pour édition"
    },
    "getPublishedStory": {
      "method": "GET",
      "path": "/published-story/:id", 
      "auth": true,
      "purpose": "Histoire publiée pour édition"
    },

  },
  "database_operations": {
    "prisma_queries": "SELECT avec relations user, likes selon besoins",
    "ownership_check": "Vérifier ownership pour routes privées d'édition",
    "like_logic": "INSERT ou DELETE dans table likes"
  },
  "error_handling": {
    "method": "try/catch avec res.status().json()",
    "no_complex_error_management": true
  },
  "constraints": [
    "SIMPLICITÉ MAXIMALE",
    "Pas d'invention - logique pure", 
    "Middleware auth seulement sur routes privées",
    "Retours JSON standardisés",
    "Gestion ownership stories pour édition"
  ]
}

ANALYSE DU LOADSERVICE EXISTANT :

Routes à implémenter (EXACTEMENT)

PUBLIC (pas d'auth) :

GET /api/get/latest → getLatest() → retourne StoryCard[]

GET /api/get/story/:id → getStory(id) → retourne StoryReader

GET /api/get/stories/:userId → getStories(userId) → retourne UserStories[]

PRIVÉ (auth required) :

GET /api/get/stats → getStats() → retourne UserStats

GET /api/get/drafts → getDrafts() → retourne Draft[]

GET /api/get/published → getPublished() → retourne Published[]

GET /api/get/draft-story/:id → getDraftStory(id) → retourne EditStory

GET /api/get/published-story/:id → getPublishedStory(id) → retourne EditStory

Interfaces exactes à respecter

typescript

StoryCard { id, title, publishDate, user: { username, avatar } }
StoryReader { id, title, content, publishDate, likes, isliked, user: { id, username, avatar, description } }
UserStories { id, title }
UserStats { drafts, published, totalLikes }
Draft { id, title, lastModified }
Published { id, title, lastModified, likes }
EditStory { id, title, content }

Logique métier

LoadController = ID IN → DATA OUT

Pas de résolution titre/username (c'est le resolver)

Ownership check sur routes d'édition privées

Calcul isliked selon user connecté

Retours JSON standardisés