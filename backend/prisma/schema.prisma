generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//============ ENUMS ============

enum UserRole {
  admin
  user
}

enum StoryStatus {
  DRAFT
  PUBLISHED
}

//============ USER MODEL ============

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique @db.VarChar(50)
  email        String   @unique @db.VarChar(100)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  description  String?  @db.Text
  avatar       String?  @db.VarChar(255)
  role         UserRole @default(user)
  playerId     String?  @map("player_id") @db.VarChar(100)
  playerDays   Int?     @map("player_days")
  createdAt    DateTime @default(now()) @map("created_at")
  
  stories      Story[]
  likes        Like[]
  
  @@map("users")
}

//============ STORY MODEL ============

model Story {
  id              Int         @id @default(autoincrement())
  title           String      @db.VarChar(200)
  content         String      @db.Text
  status          StoryStatus @default(DRAFT)
  userId          Int         @map("user_id")
  originalStoryId Int?        @map("original_story_id")
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")
  publishedAt     DateTime?   @map("published_at")
  
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes           Like[]
  
  @@index([userId, status])
  @@index([status, publishedAt])
  @@index([originalStoryId])
  @@map("stories")
}

//============ LIKE MODEL ============

model Like {
  id      Int      @id @default(autoincrement())
  userId  Int      @map("user_id")
  storyId Int      @map("story_id")
  createdAt DateTime @default(now()) @map("liked_at")
  
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  story   Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)
  
  @@unique([userId, storyId])
  @@map("likes")
}